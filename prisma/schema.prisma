generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                   String      @id @default(cuid())
  name                 String?
  email                String      @unique
  password             String
  isAdmin              Boolean     @default(false)
  notificationsEnabled Boolean     @default(true)
  timeFormat           String      @default("12h")
  workHours            Int         @default(8)
  workMinutes          Int         @default(0)
  breakMinutes         Int         @default(60)
  workLogs             WorkLog[]
  notifications        Notification[]
  timerState           TimerState?
  createdAt  DateTime    @default(now())
}

model WorkLog {
  id           String    @id @default(cuid())
  userId       String
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  date         DateTime
  punchIn      DateTime
  punchOut     DateTime?
  breakMinutes Int       @default(0)
  totalHours   Float?
  status       String    @default("active")
  notes        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([userId, date])
}

model TimerState {
  id                 String   @id @default(cuid())
  userId             String   @unique
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  isActive           Boolean  @default(false)
  startTime          BigInt?
  targetWorkMs       BigInt   @default(0)
  targetBreakMs      BigInt   @default(0)
  accumulatedWorkMs  BigInt   @default(0)
  accumulatedBreakMs BigInt   @default(0)
  lastStatusChange   BigInt?
  status             String   @default("idle")
  logs               Json     @default("[]")
  updatedAt          DateTime @updatedAt
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  message   String
  type      String   // "ONE_TIME" or "ALL_TIME"
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([userId, isRead])
}
